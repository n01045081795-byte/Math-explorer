<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìˆ˜í•™ ìš°ì£¼ íƒí—˜ëŒ€ - ê°œì¸í™”</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Inter font and mobile optimization */
        body { font-family: 'Inter', sans-serif; background-color: #1f2937; color: white; }
        
        /* Main screen layout (no scroll) */
        .game-screen {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
        }

        /* Large button styles */
        .mode-button, .keypad-button {
            transition: transform 0.1s;
            box-shadow: 0 4px 0 0 #0f6c44; 
            min-height: 60px; 
            touch-action: manipulation; /* ëª¨ë°”ì¼ í„°ì¹˜ ë°˜ì‘ì„± í–¥ìƒ */
        }
        .mode-button:active, .keypad-button:active {
            transform: translateY(4px);
            box-shadow: none; 
        }

        /* Menu button theme */
        .mode-button {
            background-color: #3b82f6; 
            box-shadow: 0 4px 0 0 #1e40af;
        }
        .mode-button:hover {
            background-color: #2563eb;
        }

        /* Spaceship animation */
        .spaceship {
            animation: bounce 2s infinite ease-in-out;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        /* Answer Input Display */
        #answerInputDisplay {
            min-height: 80px;
            font-size: 5rem;
            letter-spacing: 1rem; /* ìˆ«ì ê°„ê²© ë„“ê²Œ */
            padding: 0 1rem;
            color: #ffcc00;
        }
    </style>
</head>
<body class="bg-gray-900">

    <div id="app" class="game-screen w-full max-w-lg mx-auto">

        <!-- 1. Top Score and Mode Display -->
        <header class="w-full text-center space-y-2 flex-shrink-0">
            <h1 class="text-3xl font-extrabold text-yellow-400">ğŸš€ ìˆ˜í•™ ìš°ì£¼ íƒí—˜ëŒ€ ğŸª</h1>
            <div class="flex justify-around bg-gray-800 p-3 rounded-xl shadow-lg">
                <span class="text-xl font-bold text-green-400">ì •ë‹µ ìˆ˜: <span id="score">0</span></span>
                <span class="text-xl font-bold text-blue-400">ëª¨ë“œ: <span id="currentModeName">ì„ íƒ í•„ìš”</span></span>
                <button onclick="showMenu()" class="text-sm font-semibold bg-gray-700 hover:bg-gray-600 px-2 py-1 rounded">ë©”ë‰´</button>
            </div>
        </header>

        <!-- 2. Main Content Area (Problem or Menu) -->
        <main class="flex flex-col items-center justify-center space-y-4 flex-grow w-full text-center">
            
            <div id="gameArea" class="w-full h-full flex flex-col items-center justify-center space-y-4" style="display:none;">
                <div class="spaceship text-6xl flex-shrink-0">ğŸ§‘â€ğŸš€</div>
                
                <!-- ë¬¸ì œ í‘œì‹œ -->
                <div id="problemDisplay" class="text-6xl font-black bg-blue-900 p-4 rounded-3xl shadow-2xl border-4 border-blue-500 flex-shrink-0">
                    <!-- Problem loading area -->
                </div>

                <!-- ì •ë‹µ ì…ë ¥ ë¹ˆì¹¸ -->
                <div class="w-full max-w-xs h-20 border-b-4 border-dashed border-white bg-gray-800 rounded-xl flex items-center justify-center shadow-inner mt-4">
                    <span id="answerInputDisplay" class="font-bold"></span>
                </div>

                <!-- ë©”ì‹œì§€ í”¼ë“œë°± -->
                <div id="feedbackMessage" class="text-3xl font-extrabold h-10 flex-shrink-0"></div>
            </div>

            <!-- ë©”ë‰´ í™”ë©´ -->
            <div id="menuArea" class="w-full p-4 bg-gray-800 rounded-xl shadow-2xl space-y-4">
                <h2 class="text-2xl font-bold text-yellow-300" id="welcomeMessage">â­ ìˆ˜í•™ ìš°ì£¼ íƒí—˜ëŒ€ â­</h2>
                <div id="nameInputArea" class="space-y-3">
                    <p class="text-lg">ğŸ‘‹ íƒí—˜ê°€ë‹˜ì˜ ì´ë¦„ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”:</p>
                    <input type="text" id="userNameInput" placeholder="ì˜ˆ: ì—°ì„œ" class="w-full p-3 rounded-lg text-black text-center text-xl" maxlength="5">
                    <button id="startButton" onclick="startNameEntry()" class="mode-button w-full p-3 text-2xl font-bold">ì´ë¦„ í™•ì • ë° ì‹œì‘</button>
                </div>
                
                <!-- ëª¨ë“œ ì„ íƒì€ ì´ë¦„ ì…ë ¥ í›„ ë‚˜íƒ€ë‚¨ -->
                <div id="modeSelectionArea" style="display:none;">
                    <h3 class="text-xl font-bold text-yellow-300 mb-3">ğŸš€ ëª¨ë“œ ì„ íƒ</h3>
                    <div id="modeButtons" class="grid grid-cols-2 gap-3">
                        <!-- Buttons are loaded by JS -->
                    </div>
                </div>
            </div>
        </main>

        <!-- 3. í•˜ë‹¨ í‚¤íŒ¨ë“œ ê·¸ë¦¬ë“œ -->
        <footer id="keypadFooter" class="w-full max-w-sm grid grid-cols-3 gap-2 flex-shrink-0">
            <!-- í‚¤íŒ¨ë“œ ë²„íŠ¼ì€ JSì—ì„œ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤. -->
        </footer>

    </div>

    <script type="module">
        // --- Game State Management ---
        let score = 0;
        let correctAnswer = 0;
        let currentMode = null;
        let gameActive = false; 
        let currentInput = ""; 
        let userName = "íƒí—˜ê°€"; // ê¸°ë³¸ ì´ë¦„

        // --- Mode Definitions ---
        const MODES = {
            'count': { name: 'ìˆ«ì ì„¸ê¸° (5ì´í•˜)', min: 1, max: 5, op: 'count' },
            'count_hard': { name: 'ìˆ«ì ì„¸ê¸° (10ì´í•˜)', min: 1, max: 10, op: 'count' },
            'add_one': { name: 'ë§ì…ˆ (í•œ ìë¦¬)', min: 1, max: 9, op: '+' },
            'sub_one': { name: 'ëº„ì…ˆ (í•œ ìë¦¬, ìŒìˆ˜X)', min: 1, max: 9, op: '-' },
            'add_two_no_carry': { name: 'ë§ì…ˆ (ë‘ ìë¦¬, ì˜¬ë¦¼X)', min: 10, max: 88, op: '+' }, 
            'sub_two_no_borrow': { name: 'ëº„ì…ˆ (ë‘ ìë¦¬, ë‚´ë¦¼X)', min: 10, max: 99, op: '-' }, 
        };

        // --- DOM Elements ---
        const scoreElement = document.getElementById('score');
        const modeNameElement = document.getElementById('currentModeName');
        const problemDisplay = document.getElementById('problemDisplay');
        const feedbackMessage = document.getElementById('feedbackMessage');
        const buttonContainer = document.getElementById('modeButtons');
        const keypadFooter = document.getElementById('keypadFooter');
        const gameArea = document.getElementById('gameArea');
        const menuArea = document.getElementById('menuArea');
        const answerInputDisplay = document.getElementById('answerInputDisplay');
        const userNameInput = document.getElementById('userNameInput');
        const nameInputArea = document.getElementById('nameInputArea');
        const modeSelectionArea = document.getElementById('modeSelectionArea');
        const welcomeMessage = document.getElementById('welcomeMessage');

        // --- í”¼ë“œë°± ë° ì‘ì› ë©”ì‹œì§€ ---
        function playFeedback(isCorrect) {
            let message;
            if (isCorrect) {
                const congrats = ["ì •ë‹µ!", "ì•„ì£¼ ì˜í–ˆì–´!", "ìµœê³ ì•¼!", "ë©‹ì ¸!"];
                message = `${userName}ì•¼, ${congrats[Math.floor(Math.random() * congrats.length)]} âœ¨`;
            } else {
                const encourage = ["ë‹¤ì‹œ í•œë²ˆ!", "ì¡°ê¸ˆ ì•„ì‰¬ì›Œ!", "í•œë²ˆ ë” ìƒê°í•´ë³´ì!"];
                message = `${userName}ì•¼, ${encourage[Math.floor(Math.random() * encourage.length)]} âŒ`;
            }
            
            const color = isCorrect ? 'text-green-400' : 'text-red-500';

            feedbackMessage.textContent = message;
            feedbackMessage.className = `text-3xl font-extrabold h-10 ${color}`;

            setTimeout(() => {
                feedbackMessage.textContent = '';
                feedbackMessage.className = `text-3xl font-extrabold h-10`;
            }, 1000);
        }
        
        // --- ì´ë¦„ ì…ë ¥ ì²˜ë¦¬ ë° ë©”ë‰´ í‘œì‹œ ---
        function startNameEntry() {
            const input = userNameInput.value.trim();
            if (input.length > 0) {
                userName = input;
                showModeSelection();
            } else {
                alert("ì´ë¦„ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”!");
            }
        }
        window.startNameEntry = startNameEntry; // ì „ì—­ ë…¸ì¶œ

        function showMenu() {
            gameActive = false;
            gameArea.style.display = 'none';
            keypadFooter.style.display = 'none';
            menuArea.style.display = 'block';

            // ì´ˆê¸° ì‹œì‘ ì‹œ ì´ë¦„ ì…ë ¥ í™”ë©´ë¶€í„° ë³´ì—¬ì£¼ê¸°
            nameInputArea.style.display = 'block';
            modeSelectionArea.style.display = 'none';
            welcomeMessage.textContent = "â­ ìˆ˜í•™ ìš°ì£¼ íƒí—˜ëŒ€ â­";

            score = 0;
            scoreElement.textContent = score;
            modeNameElement.textContent = 'ì„ íƒ í•„ìš”';
            feedbackMessage.textContent = '';
        }
        window.showMenu = showMenu;


        // --- ëª¨ë“œ ì„ íƒ í™”ë©´ í‘œì‹œ ---
        function showModeSelection() {
            nameInputArea.style.display = 'none';
            modeSelectionArea.style.display = 'block';
            welcomeMessage.textContent = `ğŸš€ ${userName} íƒí—˜ê°€ë‹˜, í™˜ì˜í•©ë‹ˆë‹¤!`;

            buttonContainer.innerHTML = '';
            
            Object.keys(MODES).forEach(key => {
                const mode = MODES[key];
                const button = document.createElement('button');
                button.textContent = mode.name;
                button.className = 'mode-button p-3 text-lg font-bold text-white rounded-xl';
                button.onclick = () => startGame(key);
                buttonContainer.appendChild(button);
            });
        }


        // --- ê²Œì„ ì‹œì‘ (ëª¨ë“œ ì„ íƒ í›„) ---
        function startGame(modeKey) {
            currentMode = MODES[modeKey];
            modeNameElement.textContent = currentMode.name;

            gameActive = true;
            menuArea.style.display = 'none';
            gameArea.style.display = 'flex';
            keypadFooter.style.display = 'grid';

            generateKeypad();
            generateProblem();
            showMessage(`${userName}ì•¼, íƒí—˜ì„ ì‹œì‘í•˜ì!`, 'text-blue-400');
        }


        // --- ë¬¸ì œ ìƒì„± ë¡œì§ (ì´ì „ê³¼ ë™ì¼) ---
        function generateProblem() {
            if (!currentMode) return;

            let num1, num2;
            const operator = currentMode.op;
            let visualProblem = '';

            // ì…ë ¥ ì´ˆê¸°í™”
            currentInput = "";
            answerInputDisplay.textContent = "";

            if (operator === 'count') {
                const min = currentMode.min;
                const max = currentMode.max;
                num1 = Math.floor(Math.random() * (max - min + 1)) + min; 
                correctAnswer = num1;
                
                const items = ['â­', 'ğŸª', 'â˜„ï¸', 'ğŸŒ‘', 'ğŸ‘½'];
                const item = items[Math.floor(Math.random() * items.length)];
                for (let i = 0; i < num1; i++) {
                    visualProblem += item + (i % 5 === 4 ? '<br>' : ''); 
                }
                problemDisplay.innerHTML = `<span class="text-4xl block mb-4">${item}ì„ ì„¸ì–´ë³´ì„¸ìš”!</span><span class="text-6xl">${visualProblem}</span>`;
            
            } else {
                
                if (operator === '+') {
                    if (currentMode.name.includes("í•œ ìë¦¬")) {
                        num1 = Math.floor(Math.random() * 9) + 1;
                        num2 = Math.floor(Math.random() * 9) + 1;
                    } else {
                        let tens1, units1, tens2, units2;
                        units1 = Math.floor(Math.random() * 9) + 1; 
                        units2 = Math.floor(Math.random() * (10 - units1)); 
                        tens1 = Math.floor(Math.random() * 8) + 1; 
                        tens2 = Math.floor(Math.random() * (9 - tens1));
                        if (tens2 === 0) tens2 = 1; 
                        
                        num1 = tens1 * 10 + units1;
                        num2 = tens2 * 10 + units2;
                    }
                    correctAnswer = num1 + num2;
                    
                } else if (operator === '-') {
                    
                    if (currentMode.name.includes("í•œ ìë¦¬")) {
                        num1 = Math.floor(Math.random() * 9) + 1;
                        num2 = Math.floor(Math.random() * (num1 + 1)); 
                        
                    } else {
                        let tens1, units1, tens2, units2;
                        tens1 = Math.floor(Math.random() * 8) + 2; 
                        tens2 = Math.floor(Math.random() * (tens1 - 1)) + 1; 
                        units1 = Math.floor(Math.random() * 9) + 1; 
                        units2 = Math.floor(Math.random() * (units1 + 1)); 
                        
                        num1 = tens1 * 10 + units1;
                        num2 = tens2 * 10 + units2;
                    }
                    correctAnswer = num1 - num2;
                }
                
                problemDisplay.innerHTML = `<span class="text-yellow-300">${num1}</span> <span class="text-white">${operator}</span> <span class="text-yellow-300">${num2}</span> <span class="text-white">= ?</span>`;
            }
        }
        
        // --- í‚¤íŒ¨ë“œ ìƒì„± ---
        function generateKeypad() {
            keypadFooter.innerHTML = '';
            
            const keys = [7, 8, 9, 4, 5, 6, 1, 2, 3, 'C', 0, 'OK'];

            keys.forEach(key => {
                const button = document.createElement('button');
                button.textContent = key === 'C' ? 'â†' : (key === 'OK' ? 'í™•ì¸' : key);
                
                let bgColor = 'bg-green-500';
                if (key === 'C') bgColor = 'bg-red-500';
                if (key === 'OK') bgColor = 'bg-blue-500';

                button.className = `keypad-button p-4 text-3xl font-bold text-white rounded-xl shadow-xl ${bgColor}`;
                
                if (key === 'OK') {
                    button.onclick = checkAnswer;
                } else if (key === 'C') {
                    button.onclick = clearInput;
                } else {
                    button.onclick = () => appendInput(key.toString());
                }
                
                keypadFooter.appendChild(button);
            });
        }
        
        // --- ì…ë ¥ ì¶”ê°€ ---
        function appendInput(digit) {
            if (!gameActive) return;

            const maxDigits = (correctAnswer >= 100) ? 3 : 2; 

            if (currentInput.length < maxDigits) {
                currentInput += digit;
                answerInputDisplay.textContent = currentInput;
            }
        }
        window.appendInput = appendInput;


        // --- ì…ë ¥ ì§€ìš°ê¸° ---
        function clearInput() {
            if (!gameActive) return;
            currentInput = currentInput.slice(0, -1);
            answerInputDisplay.textContent = currentInput;
        }
        window.clearInput = clearInput;


        // --- ë‹µë³€ í™•ì¸ (ì£¼ê´€ì‹) ---
        function checkAnswer() {
            if (!gameActive || currentInput === "") {
                showMessage(`${userName}ì•¼, ìˆ«ìë¥¼ ì…ë ¥í•´ ì¤˜ì•¼ í•´!`, "text-red-500");
                return;
            }

            keypadFooter.querySelectorAll('button').forEach(btn => btn.disabled = true);

            const userGuess = parseInt(currentInput);

            if (userGuess === correctAnswer) {
                playFeedback(true);
                score++;
                scoreElement.textContent = score;

                // ì •ë‹µ: ë‹¤ìŒ ë¬¸ì œë¡œ ì´ë™
                setTimeout(() => {
                    keypadFooter.querySelectorAll('button').forEach(btn => btn.disabled = false);
                    generateProblem();
                }, 1000);

            } else {
                playFeedback(false);
                
                // ì˜¤ë‹µ: ì…ë ¥ ì´ˆê¸°í™” ë° ì¬ì‹œë„ ê¸°íšŒ ì œê³µ (ë¬¸ì œëŠ” ìœ ì§€)
                setTimeout(() => {
                    keypadFooter.querySelectorAll('button').forEach(btn => btn.disabled = false);
                    currentInput = "";
                    answerInputDisplay.textContent = "";
                    showMessage(`${userName}ì•¼, ë‹¤ì‹œ ì…ë ¥í•´ ë³´ì!`, "text-yellow-400"); // íŒíŠ¸ ë©”ì‹œì§€
                }, 1000);
            }
        }
        window.checkAnswer = checkAnswer;


        // --- ê¸°íƒ€ ë©”ì‹œì§€ ì¶œë ¥ ---
        function showMessage(text, colorClass) {
            feedbackMessage.textContent = text;
            feedbackMessage.className = `text-3xl font-extrabold h-10 ${colorClass}`;
        }

        // --- ì´ˆê¸°í™” ë° ì‹œì‘ ---
        function initializeGame() {
            const app = document.getElementById('app');
            app.style.height = `${window.innerHeight}px`;
            window.onresize = () => app.style.height = `${window.innerHeight}px`;

            showMenu();
        }

        window.onload = initializeGame;

    </script>
</body>
</html>
